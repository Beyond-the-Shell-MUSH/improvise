var Moo={};(function(a){_.extend(a,{endsWith:function(b,c){return b.indexOf(c,b.length-c.length)!==-1},isString:function(b){return typeof(b)=="string"&&!(a.endsWith(b,"|obj")||a.endsWith(b,"|err"))},isObjectNumber:function(b){return typeof(b)=="string"&&a.endsWith(b,"|obj")},isError:function(b){return typeof(b)=="string"&&a.endsWith(b,"|err")},isBinary:function(b){return b===0||b===1},isValidPerms:function(b,c){return typeof(b)=="string"&&b.match("^["+c+"]*$")},isValidObj:function(b){return _.include(["this","none","any"],b)},isValidPrep:function(c){var b=["with","using","at","to","in front of","in","inside","into","on top of","on","onto","upon","out of","from inside","from","over","through","under","underneath","beneath","behind","beside","for","about","is","as","off","off of","none","any"];return _.include(b,c)},isValidCode:function(b){return _.isArray(b)&&_.all(b,a.isString)},isValidObjectNumberArray:function(b){return _.isArray(b)&&_.all(b,a.isObjectNumber)}});a.NestedModel=Backbone.Model.extend({get:function(b,d){d=d||{};var f=b.split("."),c=f.shift();var e=Backbone.Model.prototype.get.call(this,c,d);_.each(f,function(g){e=e[g]});return e},set:function(d,f,e){var c;if(_.isObject(d)){c=d;e=f}else{c={};c[d]=f}e=e||{};var b=_.inject(this.attributes,function(g,i,h){g[h]=_.clone(i);return g},{});_.each(c,function(j,g){var l=g.split("."),h=l.shift();var k=b,i=h;_.each(l,function(m){if(!(i in k)){k[i]={}}k=k[i];i=m});k[i]=j});return Backbone.Model.prototype.set.call(this,b,e)}});a.Attribute=a.NestedModel.extend({validate:function(b){if(b&&"Value" in b&&(typeof(b.Value)!="object")){return"invalid attribute"}}});a.Value=a.NestedModel.extend({validate:function(b){if(b&&"Value" in b&&(typeof(b.Value)!="object")){return"invalid value"}if(b&&"Value" in b&&"clear" in b.Value&&!a.isBinary(b.Value.clear)){return"invalid value: `clear' must be 0 or 1"}}});a.Property=a.NestedModel.extend({validate:function(b){if(b&&"Property" in b&&(typeof(b.Property)!="object")){return"invalid property"}if(b&&"Property" in b&&"name" in b.Property&&!a.isString(b.Property.name)){return"invalid property: `name' must be a string"}if(b&&"Property" in b&&"owner" in b.Property&&!a.isObjectNumber(b.Property.owner)){return"invalid property: `owner' must be an object number"}if(b&&"Property" in b&&"perms" in b.Property&&!a.isValidPerms(b.Property.perms,"rwc")){return"invalid property: `perms' must be in the set 'rwc'"}}});a.Verb=a.NestedModel.extend({validate:function(b){if(b&&"Verb" in b&&(typeof(b.Verb)!="object")){return"invalid verb"}if(b&&"Verb" in b&&"names" in b.Verb&&!a.isString(b.Verb.names)){return"invalid verb: `names' must be a string"}if(b&&"Verb" in b&&"owner" in b.Verb&&!a.isObjectNumber(b.Verb.owner)){return"invalid verb: `owner' must be an object number"}if(b&&"Verb" in b&&"perms" in b.Verb&&!a.isValidPerms(b.Verb.perms,"rwxd")){return"invalid verb: `perms' must be in the set 'rwxd'"}if(b&&"Verb" in b&&"dobj" in b.Verb&&!a.isValidObj(b.Verb.dobj)){return"invalid verb: `dobj' must be valid"}if(b&&"Verb" in b&&"prep" in b.Verb&&!a.isValidPrep(b.Verb.prep)){return"invalid verb: `prep' must be valid"}if(b&&"Verb" in b&&"iobj" in b.Verb&&!a.isValidObj(b.Verb.iobj)){return"invalid verb: `iobj' must be valid"}if(b&&"Verb" in b&&"code" in b.Verb&&!a.isValidCode(b.Verb.code)){return"invalid verb: `code' must be an array of strings"}}});a.Attributes=Backbone.Collection.extend({model:a.Attribute});a.Values=Backbone.Collection.extend({model:a.Value});a.Properties=Backbone.Collection.extend({model:a.Property});a.Verbs=Backbone.Collection.extend({model:a.Verb});a.Object=Backbone.Model.extend({urlRoot:"///objects",initialize:function(){this.attributez=new a.Attributes;this.attributez.url=this.url()+"/attributes";this.values=new a.Values;this.values.url=this.url()+"/values";this.properties=new a.Properties;this.properties.url=this.url()+"/properties";this.verbs=new a.Verbs;this.verbs.url=this.url()+"/verbs";this.parse(this.attributes)},validate:function(b){var c,d;if((c=this.attributez.get("player"))&&!a.isBinary(c.get("Value.value"))){return"invalid attribute: `player' must be 0 or 1"}if((c=this.attributez.get("parents"))&&!a.isValidObjectNumberArray(c.get("Value.value"))){return"invalid attribute: `parents' must be an array of object numbers"}if((d=this.values.get("name"))&&!a.isString(d.get("Value.value"))){return"invalid value: `name' must be a string"}if((d=this.values.get("owner"))&&!a.isObjectNumber(d.get("Value.value"))){return"invalid value: `owner' must be an object number"}if((d=this.values.get("location"))&&!a.isObjectNumber(d.get("Value.value"))){return"invalid value: `location' must be an object number"}if((d=this.values.get("contents"))&&!a.isValidObjectNumberArray(d.get("Value.value"))){return"invalid value: `contents' must be an array of object numbers"}if((d=this.values.get("programmer"))&&!a.isBinary(d.get("Value.value"))){return"invalid value: `programmer' must be 0 or 1"}if((d=this.values.get("wizard"))&&!a.isBinary(d.get("Value.value"))){return"invalid value: `wizard' must be 0 or 1"}if((d=this.values.get("r"))&&!a.isBinary(d.get("Value.value"))){return"invalid value: `r' must be 0 or 1"}if((d=this.values.get("w"))&&!a.isBinary(d.get("Value.value"))){return"invalid value: `w' must be 0 or 1"}if((d=this.values.get("f"))&&!a.isBinary(d.get("Value.value"))){return"invalid value: `f' must be 0 or 1"}},parse:function(c){var g=function(h,j,i){j.id=i;h.push(j);return h};var e=c.Attributes;delete c.Attributes;this.attributez.reset(_.chain(e).reduce(g,[]).value());var b=c.Values;delete c.Values;this.values.reset(_.chain(b).reduce(g,[]).value());var d=c.Properties;delete c.Properties;this.properties.reset(_.chain(d).reduce(g,[]).value());var f=c.Verbs;delete c.Verbs;this.verbs.reset(_.chain(f).reduce(g,[]).value());return c},toJSON:function(){var b=function(c,e,d){c[e.id]=e;delete e.id;return c};return{Attributes:_.chain(this.attributez.toJSON()).reduce(b,{}).value(),Values:_.chain(this.values.toJSON()).reduce(b,{}).value(),Properties:this.properties.toJSON(),Verbs:this.verbs.toJSON()}}});a.Objects=Backbone.Collection.extend({model:a.Object,url:"///objects"})})(Moo);